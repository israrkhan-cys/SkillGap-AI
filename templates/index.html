<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillGap AI - From Resume to Roadmap in Seconds</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .loading {
            display: none;
        }
        .loading.active {
            display: flex;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-12 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <div class="flex items-center justify-center mb-4">
                <i class="fas fa-brain text-5xl mr-4"></i>
                <h1 class="text-5xl font-bold">SkillGap AI</h1>
            </div>
            <p class="text-xl text-purple-100">From resume to roadmap in seconds</p>
            <p class="text-sm text-purple-200 mt-2">Powered by Groq AI (LLaMA 3)</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12 max-w-6xl">
        
        <!-- Problem & Solution Section -->
        <div class="grid md:grid-cols-2 gap-8 mb-12">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-red-600 mb-4">
                    <i class="fas fa-exclamation-triangle mr-2"></i>The Problem
                </h2>
                <ul class="space-y-2 text-gray-700">
                    <li><i class="fas fa-times-circle text-red-500 mr-2"></i>Don't know what skills are missing</li>
                    <li><i class="fas fa-times-circle text-red-500 mr-2"></i>Don't know what to learn next</li>
                    <li><i class="fas fa-times-circle text-red-500 mr-2"></i>Don't know how close to job-ready</li>
                    <li><i class="fas fa-times-circle text-red-500 mr-2"></i>Blindly follow random courses</li>
                </ul>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-green-600 mb-4">
                    <i class="fas fa-lightbulb mr-2"></i>The Solution
                </h2>
                <ul class="space-y-2 text-gray-700">
                    <li><i class="fas fa-check-circle text-green-500 mr-2"></i>AI-powered skill gap analysis</li>
                    <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Personalized learning roadmap</li>
                    <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Job readiness score (0-100)</li>
                    <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Results in under 10 seconds</li>
                </ul>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
                <i class="fas fa-upload mr-2"></i>Analyze Your CV
            </h2>
            
            <form id="cvForm" class="space-y-6">
                <!-- Target Role Selection -->
                <div>
                    <label for="targetRole" class="block text-lg font-semibold text-gray-700 mb-3">
                        <i class="fas fa-briefcase mr-2 text-purple-600"></i>Target Career Role (any field)
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <select id="targetRole" name="target_role" 
                                class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white">
                            <option value="">Select a predefined role...</option>
                            <option value="Software Engineer">Software Engineer</option>
                            <option value="Frontend Developer">Frontend Developer</option>
                            <option value="Backend Developer">Backend Developer</option>
                            <option value="Full Stack Developer">Full Stack Developer</option>
                            <option value="Data Scientist">Data Scientist</option>
                            <option value="Data Analyst">Data Analyst</option>
                            <option value="Machine Learning Engineer">Machine Learning Engineer</option>
                            <option value="AI Engineer">AI Engineer</option>
                            <option value="DevOps Engineer">DevOps Engineer</option>
                            <option value="Cloud Engineer">Cloud Engineer</option>
                            <option value="Cybersecurity Analyst">Cybersecurity Analyst</option>
                            <option value="Mobile Developer">Mobile Developer</option>
                            <option value="Web Developer">Web Developer</option>
                            <option value="QA Engineer">QA Engineer</option>
                            <option value="Database Administrator">Database Administrator</option>
                            <option value="Product Manager">Product Manager</option>
                            <option value="UX Designer">UX Designer</option>
                            <option value="UI Designer">UI Designer</option>
                            <option value="Marketing Manager">Marketing Manager</option>
                            <option value="HR Manager">HR Manager</option>
                            <option value="Finance Analyst">Finance Analyst</option>
                            <option value="Project Manager">Project Manager</option>
                            <option value="Business Analyst">Business Analyst</option>
                            <option value="Civil Engineer">Civil Engineer</option>
                            <option value="Mechanical Engineer">Mechanical Engineer</option>
                        </select>
                        <input type="text" id="customRole" name="custom_role" placeholder="Or enter any role here..." 
                               class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <p class="text-sm text-gray-500">Pick from the list or type any role you're targeting (tech or non-tech)</p>
                </div>

                <!-- File Upload -->
                <div class="border-2 border-dashed border-purple-300 rounded-lg p-8 text-center hover:border-purple-500 transition-colors">
                    <i class="fas fa-cloud-upload-alt text-6xl text-purple-400 mb-4"></i>
                    <label for="fileInput" class="cursor-pointer">
                        <span class="text-lg font-semibold text-gray-700">Upload your CV/Resume</span>
                        <p class="text-sm text-gray-500 mt-2">PDF, DOCX, or TXT (Max 16MB)</p>
                        <input type="file" id="fileInput" name="file" accept=".pdf,.docx,.txt" class="hidden">
                        <button type="button" onclick="document.getElementById('fileInput').click()" 
                                class="mt-4 bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            Choose File
                        </button>
                    </label>
                    <p id="fileName" class="text-sm text-green-600 mt-3 font-medium"></p>
                </div>

                <!-- OR Divider -->
                <div class="flex items-center my-6">
                    <div class="flex-1 border-t border-gray-300"></div>
                    <span class="px-4 text-gray-500 font-semibold">OR</span>
                    <div class="flex-1 border-t border-gray-300"></div>
                </div>

                <!-- Text Area -->
                <div>
                    <label for="cvText" class="block text-lg font-semibold text-gray-700 mb-2">
                        <i class="fas fa-keyboard mr-2"></i>Paste Your CV Text
                    </label>
                    <textarea id="cvText" name="cv_text" rows="8" 
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                              placeholder="Paste your entire CV/resume here..."></textarea>
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" id="analyzeBtn"
                            class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-12 py-4 rounded-lg text-xl font-bold hover:from-purple-700 hover:to-indigo-700 transform hover:scale-105 transition-all shadow-lg">
                        <i class="fas fa-magic mr-2"></i>Analyze My Skills
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading Animation -->
        <div id="loading" class="loading flex-col items-center justify-center my-12">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-600 mb-4"></div>
            <p class="text-xl font-semibold text-gray-700 pulse-animation">Analyzing your CV with AI...</p>
            <p class="text-sm text-gray-500 mt-2">This usually takes 5-10 seconds</p>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
                    <i class="fas fa-chart-line mr-2"></i>Your Skill Gap Analysis
                </h2>
                <div id="roleDisplay" class="mb-4 text-center">
                    <span class="inline-block bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-semibold">
                        <i class="fas fa-target mr-2"></i>Analysis for: <span id="selectedRole">General Tech Role</span>
                    </span>
                </div>
                
                <!-- Skills Comparison Chart -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">
                        <i class="fas fa-chart-bar mr-2 text-indigo-600"></i>Current Skills vs Missing Skills
                    </h3>
                    <div style="max-width: 500px; margin: 0 auto;">
                        <canvas id="skillsChart" height="250"></canvas>
                    </div>
                </div>
                
                <div id="analysisContent" class="prose max-w-none">
                    <!-- AI results will be inserted here -->
                </div>

                <!-- Action Buttons -->
                <div class="mt-8 text-center space-x-4 flex flex-wrap justify-center gap-3">
                    <button id="downloadPdfBtn" onclick="downloadAnalysisPDF()" 
                            class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-file-pdf mr-2"></i>Download PDF Report
                    </button>
                    <button onclick="window.print()" 
                            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-print mr-2"></i>Print Report
                    </button>
                    <button onclick="location.reload()" 
                            class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                        <i class="fas fa-redo mr-2"></i>Analyze Another CV
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden bg-red-50 border-l-4 border-red-500 p-6 rounded-lg mb-8 fade-in">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-red-500 text-2xl mr-3"></i>
                <div>
                    <h3 class="text-lg font-semibold text-red-800">Error</h3>
                    <p id="errorText" class="text-red-700"></p>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-8 mt-16">
        <div class="container mx-auto px-4 text-center">
            <p class="text-lg font-semibold mb-2">Built for Hackathon 2026</p>
            <p class="text-purple-200 text-sm">Empowering students and professionals to bridge their skill gaps</p>
            <div class="mt-4 text-sm">
                <span class="inline-block bg-purple-800 px-3 py-1 rounded-full mr-2">Python + Flask</span>
                <span class="inline-block bg-purple-800 px-3 py-1 rounded-full mr-2">Groq AI</span>
                <span class="inline-block bg-purple-800 px-3 py-1 rounded-full">Tailwind CSS</span>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const cvForm = document.getElementById('cvForm');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const analysisContent = document.getElementById('analysisContent');
        let currentSessionId = null;  // Store session ID for PDF download

        // File input change handler
        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                fileName.textContent = `Selected: ${e.target.files[0].name}`;
                // Clear text area when file is selected
                document.getElementById('cvText').value = '';
            } else {
                fileName.textContent = '';
            }
        });

        // Form submission
        cvForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Hide previous results and errors
            results.classList.add('hidden');
            errorMessage.classList.add('hidden');
            loading.classList.add('active');

            const formData = new FormData(cvForm);
            const customRole = document.getElementById('customRole').value.trim();
            const targetRole = customRole || document.getElementById('targetRole').value || 'General Professional Role';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                loading.classList.remove('active');

                if (response.ok) {
                    // Display results
                    analysisContent.innerHTML = formatAnalysis(data.analysis);
                    document.getElementById('selectedRole').textContent = targetRole;
                    currentSessionId = data.session_id;  // Store session ID for PDF download
                    results.classList.remove('hidden');
                    
                    // Scroll to results
                    results.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    // Display error
                    errorText.textContent = data.error || 'An error occurred while analyzing your CV.';
                    errorMessage.classList.remove('hidden');
                }
            } catch (error) {
                loading.classList.remove('active');
                errorText.textContent = 'Failed to connect to the server. Please try again.';
                errorMessage.classList.remove('hidden');
            }
        });

        function formatAnalysis(text) {
            // Convert the AI response to nicely formatted HTML
            let html = text;
            
            // Extract current and missing skills for chart
            const currentSkillsMatch = text.match(/\*\*CURRENT SKILLS IDENTIFIED:\*\*([\s\S]*?)(?=\*\*|$)/);
            const missingSkillsMatch = text.match(/\*\*MISSING SKILLS:\*\*([\s\S]*?)(?=\*\*|$)/);
            
            let currentSkillsCount = 0;
            let missingSkillsCount = 0;
            
            if (currentSkillsMatch) {
                currentSkillsCount = (currentSkillsMatch[1].match(/^-/gm) || []).length;
            }
            if (missingSkillsMatch) {
                missingSkillsCount = (missingSkillsMatch[1].match(/^-|^ðŸ”´|^ðŸŸ¡/gm) || []).length;
            }
            
            // Draw chart if we have data
            if (currentSkillsCount > 0 || missingSkillsCount > 0) {
                setTimeout(() => drawSkillsChart(currentSkillsCount, missingSkillsCount), 100);
            }
            
            // Bold headings
            html = html.replace(/\*\*(.+?)\*\*/g, '<h3 class="text-2xl font-bold text-gray-800 mt-6 mb-4">$1</h3>');
            
            // Convert PRIORITY skills with red indicators and learning resources
            html = html.replace(/ðŸ”´ PRIORITY 1: (.+?) - (.+?)\s*\|\s*Learn:\s*(.+)/g, 
                '<div class="bg-red-50 border-l-4 border-red-500 p-3 mb-3 rounded">' +
                '<span class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-bold mr-2">ðŸ”´ PRIORITY 1 - CRITICAL</span>' +
                '<span class="font-semibold text-gray-800">$1</span> - <span class="text-gray-600">$2</span>' +
                '<br><a href="javascript:searchTutorial(\'$1\', \'$3\')" class="text-xs text-red-600 hover:text-red-800 font-semibold mt-2 inline-block"><i class="fas fa-book mr-1"></i>Learn with $3 â†’</a>' +
                '</div>');
            
            html = html.replace(/ðŸ”´ PRIORITY 2: (.+?) - (.+?)\s*\|\s*Learn:\s*(.+)/g, 
                '<div class="bg-orange-50 border-l-4 border-orange-500 p-3 mb-3 rounded">' +
                '<span class="inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold mr-2">ðŸ”´ PRIORITY 2 - HIGH</span>' +
                '<span class="font-semibold text-gray-800">$1</span> - <span class="text-gray-600">$2</span>' +
                '<br><a href="javascript:searchTutorial(\'$1\', \'$3\')" class="text-xs text-orange-600 hover:text-orange-800 font-semibold mt-2 inline-block"><i class="fas fa-book mr-1"></i>Learn with $3 â†’</a>' +
                '</div>');
            
            html = html.replace(/ðŸŸ¡ PRIORITY 3: (.+?) - (.+?)\s*\|\s*Learn:\s*(.+)/g, 
                '<div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 mb-3 rounded">' +
                '<span class="inline-block bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold mr-2">ðŸŸ¡ PRIORITY 3 - MEDIUM</span>' +
                '<span class="font-semibold text-gray-800">$1</span> - <span class="text-gray-600">$2</span>' +
                '<br><a href="javascript:searchTutorial(\'$1\', \'$3\')" class="text-xs text-yellow-600 hover:text-yellow-800 font-semibold mt-2 inline-block"><i class="fas fa-book mr-1"></i>Learn with $3 â†’</a>' +
                '</div>');
            
            // Convert regular bullet points with learning resources
            html = html.replace(/^- (.+?) - (.+?)\s*\|\s*Learn:\s*(.+)$/gm, 
                '<li class="ml-6 mb-3 text-gray-700 bg-blue-50 p-2 rounded">' +
                'â€¢ <span class="font-semibold">$1</span> - $2 ' +
                '<a href="javascript:searchTutorial(\'$1\', \'$3\')" class="text-xs text-blue-600 hover:text-blue-800 font-semibold ml-2"><i class="fas fa-book mr-1"></i>Learn â†’</a>' +
                '</li>');
            
            // Convert regular bullet points (without learning resources)
            html = html.replace(/^- (.+)$/gm, '<li class="ml-6 mb-2 text-gray-700">â€¢ $1</li>');
            
            // Convert Step numbers to styled divs
            html = html.replace(/Step (\d+): (.+?) - (.+)/g, 
                '<div class="bg-purple-50 border-l-4 border-purple-500 p-4 mb-3 rounded">' +
                '<span class="font-bold text-purple-700">Step $1:</span> ' +
                '<span class="font-semibold text-gray-800">$2</span> - ' +
                '<span class="text-gray-600">$3</span>' +
                '</div>');
            
            // Highlight the score
            html = html.replace(/Score: (\d+)\/100/g, 
                '<div class="bg-gradient-to-r from-green-400 to-blue-500 text-white text-center py-6 px-8 rounded-lg text-4xl font-bold shadow-lg mb-4">' +
                'Score: $1/100' +
                '</div>');
            
            // Wrap paragraphs
            html = html.replace(/^(?!<|â€¢|Step)(.+)$/gm, '<p class="mb-3 text-gray-700 leading-relaxed">$1</p>');
            
            return html;
        }

        // Skill to tutorial mapping
        const skillTutorials = {
            'python': { 'FreeCodeCamp': 'https://www.youtube.com/results?search_query=python+tutorial+freecodecamp', 'YouTube': 'https://www.youtube.com/results?search_query=learn+python', 'Coursera': 'https://www.coursera.org/search?query=python' },
            'javascript': { 'FreeCodeCamp': 'https://www.youtube.com/results?search_query=javascript+tutorial+freecodecamp', 'YouTube': 'https://www.youtube.com/results?search_query=learn+javascript', 'Udemy': 'https://www.udemy.com/search/?q=javascript' },
            'react': { 'FreeCodeCamp': 'https://www.youtube.com/results?search_query=react+tutorial', 'YouTube': 'https://www.youtube.com/results?search_query=learn+react', 'Coursera': 'https://www.coursera.org/search?query=react' },
            'sql': { 'YouTube': 'https://www.youtube.com/results?search_query=sql+tutorial', 'Codecademy': 'https://www.codecademy.com', 'FreeCodeCamp': 'https://www.youtube.com/results?search_query=sql+freecodecamp' },
        };

        function searchTutorial(skill, platform) {
            let url = '';
            const skillLower = skill.toLowerCase();
            
            if (skillLower in skillTutorials && platform in skillTutorials[skillLower]) {
                url = skillTutorials[skillLower][platform];
            } else {
                // Fallback: search based on platform
                const platformMap = {
                    'YouTube': `https://www.youtube.com/results?search_query=learn+${skill}`,
                    'Coursera': `https://www.coursera.org/search?query=${skill}`,
                    'Udemy': `https://www.udemy.com/search/?q=${skill}`,
                    'FreeCodeCamp': `https://www.youtube.com/results?search_query=${skill}+tutorial+freecodecamp`,
                    'Codecademy': 'https://www.codecademy.com/search?query=' + skill,
                    'LinkedIn Learning': `https://www.linkedin.com/learning/search?keywords=${skill}`
                };
                url = platformMap[platform] || `https://www.google.com/search?q=learn+${skill}`;
            }
            
            window.open(url, '_blank');
        }

        function drawSkillsChart(currentCount, missingCount) {
            const ctx = document.getElementById('skillsChart');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Current Skills', 'Missing Skills'],
                    datasets: [{
                        label: 'Number of Skills',
                        data: [currentCount, missingCount],
                        backgroundColor: [
                            'rgba(52, 211, 153, 0.7)',  // Green for current
                            'rgba(239, 68, 68, 0.7)'    // Red for missing
                        ],
                        borderColor: [
                            'rgba(52, 211, 153, 1)',
                            'rgba(239, 68, 68, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: Math.max(currentCount, missingCount) + 2,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function downloadAnalysisPDF() {
            if (!currentSessionId) {
                alert('No analysis available. Please analyze a CV first.');
                return;
            }
            
            // Trigger PDF download
            window.location.href = `/download-pdf/${currentSessionId}`;
        }
    </script>
</body>
</html>
